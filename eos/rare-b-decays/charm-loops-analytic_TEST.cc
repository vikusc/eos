/* vim: set sw=4 sts=4 et foldmethod=syntax : */

/*
 * Copyright (c) 2022 Viktor Kuschke
 *
 * This file is part of the EOS project. EOS is free software;
 * you can redistribute it and/or modify it under the terms of the GNU General
 * Public License version 2, as published by the Free Software Foundation.
 *
 * EOS is distributed in the hope that it will be useful, but WITHOUT ANY
 * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more
 * details.
 *
 * You should have received a copy of the GNU General Public License along with
 * this program; if not, write to the Free Software Foundation, Inc., 59 Temple
 * Place, Suite 330, Boston, MA  02111-1307  USA
 */

#include <test/test.hh>
#include <eos/rare-b-decays/charm-loops.hh>

#include <cmath>

using namespace test;
using namespace eos;
using namespace agv_2019a;

class LoopParameterTest :
    public TestCase
{
    public:
        LoopParameterTest() :
            TestCase("loop_parameter_test")
        {
        }

        virtual void run() const
        {
            {
                static const double eps = 1e-12;
                const complex<double> myi(0.0, 1.0);
                agv_2019a::CharmLoopsParameters testclp = {/*muhat =*/ 1.0, /*s =*/ -4.0, /*z =*/ 0.15, /*feynepsilonhat*/ 1e-10};

                /* Check, that the square root in C++ of complex arguments is handled correctly */

                static const complex<double> m1(-1.0, 0.0);
                TEST_CHECK_NEARLY_EQUAL(0.0, std::sqrt(m1).real(), eps);
                TEST_CHECK_NEARLY_EQUAL(1.0, std::sqrt(m1).imag(), eps);

                /* Comparison with Mathematica results */

                TEST_CHECK_NEARLY_EQUAL(1.5811388300841895,     testclp.x_a.real(), eps);
                TEST_CHECK_NEARLY_EQUAL(0.7745966689726898,     testclp.x_b.real(), eps);
                TEST_CHECK_NEARLY_EQUAL(1.5811388300841895,     testclp.x_c.real(), eps);
                TEST_CHECK_NEARLY_EQUAL(0.7745966689726898,     testclp.x_d.real(), eps);
                TEST_CHECK_NEARLY_EQUAL(1.5811388300841895,     testclp.x_e.real(), eps);

                TEST_CHECK_NEARLY_EQUAL(-6.719840027857805e-10, testclp.x_a.imag(), eps);
                TEST_CHECK_NEARLY_EQUAL(0.6324555318142068,     testclp.x_b.imag(), eps);
                TEST_CHECK_NEARLY_EQUAL(-6.719840027857805e-10, testclp.x_c.imag(), eps);
                TEST_CHECK_NEARLY_EQUAL(0.6324555318142068,     testclp.x_d.imag(), eps);
                TEST_CHECK_NEARLY_EQUAL(-6.719840027857805e-10, testclp.x_e.imag(), eps);

                /* Check, that the logarithm of complex numbers with negative real part is consistent with Mathematica */

                const double s_list[9] = {-1.0, -7.0 / 9.0, -5.0 / 9.0, -1.0 / 3.0, -1.0 / 9.0, 1.0 / 9.0, 1.0 / 3.0, 5.0 / 9.0, 7.0 / 9.0};
                const complex<double> lnms_ref[9] = {5.0000000000000005e-21 + 1.e-10 * myi,-0.25131442828090605 + 1.e-10 * myi,-0.587786664902119 + 1.e-10 * myi,-1.0986122886681096 + 1.0000000000000002e-10 * myi,-2.197224577336219 + 1.e-10 * myi,-2.19722457733622 - 3.141592653489793 * myi,-1.09861228866811 - 3.141592653489793 * myi,-0.5877866649021192 - 3.141592653489793 * myi,-0.2513144282809062 - 3.141592653489793 * myi};

                for (unsigned int i = 0; i < 9; i++)
                {
                    const double s = s_list[i];
                    agv_2019a::CharmLoopsParameters testclp = {/*muhat =*/ 1.0, /*s =*/ s, /*z =*/ 0.15, /*feynepsilonhat*/ 1e-10};
                    const complex<double> lnms = std::log(-testclp.s_eps);

                    TEST_CHECK_NEARLY_EQUAL(lnms_ref[i].real(), lnms.real(), eps);
                    TEST_CHECK_NEARLY_EQUAL(lnms_ref[i].imag(), lnms.imag(), eps);
                }
            }
        }
} loop_parameter_test ;

class TwoLoopTest :
    public TestCase
{
    public:
        TwoLoopTest() :
            TestCase("two_loop_test")
        {
        }

        virtual void run() const
        {
            static double eps = 1e-12;
            const complex<double> myi(0.0, 1.0);
            const double z_s_list[45][2] = {{0.05, -1.0},     {0.05, -7.0 / 9.0},    {0.05, -5.0 / 9.0},    {0.05, -1.0 / 3.0},    {0.05, -1.0 / 9.0},  {0.05, 1.0 / 9.0},  {0.05, 1.0 / 3.0},  {0.05, 5.0 / 9.0},  {0.05, 7.0 / 9.0},
                                            {0.075, -1.0},    {0.075, -7.0 / 9.0},   {0.075, -5.0 / 9.0},   {0.075, -1.0 / 3.0},   {0.075, -1.0 / 9.0}, {0.075, 1.0 / 9.0}, {0.075, 1.0 / 3.0}, {0.075, 5.0 / 9.0}, {0.075, 7.0 / 9.0},
                                            {0.1, -1.0},      {0.1, -7.0 / 9.0},     {0.1, -5.0 / 9.0},     {0.1, -1.0 / 3.0},     {0.1, -1.0 / 9.0},   {0.1, 1.0 / 9.0},   {0.1, 1.0 / 3.0},   {0.1, 5.0 / 9.0},   {0.1, 7.0 / 9.0},
                                            {0.125, -1.0},    {0.125, -7.0 / 9.0},   {0.125, -5.0 / 9.0},   {0.125, -1.0 / 3.0},   {0.125, -1.0 / 9.0}, {0.125, 1.0 / 9.0}, {0.125, 1.0 / 3.0}, {0.125, 5.0 / 9.0}, {0.125, 7.0 / 9.0},
                                            {0.15, -1.0},     {0.15, -7.0 / 9.0},    {0.15, -5.0 / 9.0},    {0.15, -1.0 / 3.0},    {0.15, -1.0 / 9.0},  {0.15, 1.0 / 9.0},  {0.15, 1.0 / 3.0},  {0.15, 5.0 / 9.0},  {0.15, 7.0 / 9.0}};

            // Counterterms

            {
                // The computation took 1.090361s AbsoluteTiming with the Mathematica-Ginac script from [AGV:2019A]
                const complex<double> f17ct_ref[45] = {0.007508380484939292 + 6.873191015900809e-13 * myi, 0.005952604401909534 + 5.547258909565289e-13 * myi, 0.004336911891155662 + 4.1182723464905446e-13 * myi, 0.002656161338996113 + 2.572749847338921e-13 * myi, 0.0009044920478106094 + 8.946448429403098e-14 * myi, -0.0009248201293365621 - 9.353157026853862e-14 * myi, -0.002839546035419166 - 2.940497627051733e-13 * myi, -0.004848738820221368 - 5.14954318682398e-13 * myi, -0.006963041259226838 - 7.598075046419174e-13 * myi, 0.007508380484939292 + 6.873191015900809e-13 * myi, 0.005952604401909534 + 5.547258909565289e-13 * myi, 0.004336911891155662 + 4.1182723464905446e-13 * myi, 0.002656161338996113 + 2.572749847338921e-13 * myi, 0.0009044920478106094 + 8.946448429403098e-14 * myi, -0.0009248201293365621 - 9.353157026853862e-14 * myi, -0.002839546035419166 - 2.940497627051733e-13 * myi, -0.004848738820221368 - 5.14954318682398e-13 * myi, -0.006963041259226838 - 7.598075046419174e-13 * myi, 0.007508380484939292 + 6.873191015900809e-13 * myi, 0.005952604401909534 + 5.547258909565289e-13 * myi, 0.004336911891155662 + 4.1182723464905446e-13 * myi, 0.002656161338996113 + 2.572749847338921e-13 * myi, 0.0009044920478106094 + 8.946448429403098e-14 * myi, -0.0009248201293365621 - 9.353157026853862e-14 * myi, -0.002839546035419166 - 2.940497627051733e-13 * myi, -0.004848738820221368 - 5.14954318682398e-13 * myi, -0.006963041259226838 - 7.598075046419174e-13 * myi, 0.007508380484939292 + 6.873191015900809e-13 * myi, 0.005952604401909534 + 5.547258909565289e-13 * myi, 0.004336911891155662 + 4.1182723464905446e-13 * myi, 0.002656161338996113 + 2.572749847338921e-13 * myi, 0.0009044920478106094 + 8.946448429403098e-14 * myi, -0.0009248201293365621 - 9.353157026853862e-14 * myi, -0.002839546035419166 - 2.940497627051733e-13 * myi, -0.004848738820221368 - 5.14954318682398e-13 * myi, -0.006963041259226838 - 7.598075046419174e-13 * myi, 0.007508380484939292 + 6.873191015900809e-13 * myi, 0.005952604401909534 + 5.547258909565289e-13 * myi, 0.004336911891155662 + 4.1182723464905446e-13 * myi, 0.002656161338996113 + 2.572749847338921e-13 * myi, 0.0009044920478106094 + 8.946448429403098e-14 * myi, -0.0009248201293365621 - 9.353157026853862e-14 * myi, -0.002839546035419166 - 2.940497627051733e-13 * myi, -0.004848738820221368 - 5.14954318682398e-13 * myi, -0.006963041259226838 - 7.598075046419174e-13 * myi};

                // The computation took 5.23546s AbsoluteTiming with the Mathematica-Ginac script from [AGV:2019A]
                const complex<double> f19ct_ref[45] = {-2.7747020877105797+5.626346304045955e-9*myi,-3.678411078930253+6.551498509238362e-9*myi,-5.189029077982212+7.622673015584751e-9*myi,-8.082810669902756+8.358442082775868e-9*myi,-15.295431631415227+4.10848830837457e-9*myi,-54.58909756932087-0.2962036019425178*myi,70.55799350353001-17.653390450324757*myi,30.565735956813924+5.7665720781398235*myi,18.123518226961437+8.16568053415471*myi,-3.893962954910876+3.6667442484171744e-9*myi,-4.9435312452224025+4.047484854303513e-9*myi,-6.590976326253326+4.3029628743453725e-9*myi,-9.469670526543581+3.875115198659835e-9*myi,-15.549077574087107-2.327794826955606e-10*myi,-34.693573875853275-0.29620348722185535*myi,167.92305609469395-169.05788651872777*myi,52.46869793945905-5.200967465309851*myi,29.684631469279182+5.682142901544971*myi,-4.6121577307674215+2.4686952677874505e-9*myi,-5.708816327234217+2.5808340482679426e-9*myi,-7.354933349386755+2.490392924813179e-9*myi,-10.05051056855254+1.734163658380889e-9*myi,-15.153979279758971-1.5672712814544838e-9*myi,-27.418279308218146-0.2962034663408389*myi,-106.01160307383219-0.18257783824640594*myi,84.59645934900874-33.95940219738226*myi,43.98892291368844-0.5735255289875738*myi,-5.072667438223817+1.6824488080230685e-9*myi,-6.166265303521357+1.655473734962947e-9*myi,-7.751673931711565+1.4166070071917854e-9*myi,-10.22260815512277+6.081296126569895e-10*myi,-14.548968500514661-1.9781302920086277e-9*myi,-23.33010199275789-0.2962034587959605*myi,-53.38314519171202-0.18257745555047408*myi,153.5213258190528-140.2100221981614*myi,62.635938975007846-13.392627642880836*myi,-5.357791346984698+1.1439296343338859e-9*myi,-6.42217138552391+1.0446350252241993e-9*myi,-7.922209335544608+7.481806136477017e-10*myi,-10.170139590163245-1.6911948663200337e-11*myi,-13.881352337142118-2.052076503827342e-9*myi,-20.571120817214762-0.29620345513394997*myi,-37.880978841112146-0.18257740232203398*myi,-180.21214469438945-0.1297454551302265*myi,89.84030337463037-40.709145314441294*myi};

                // The computation took 1.08506s AbsoluteTiming with the Mathematica-Ginac script from [AGV:2019A]
                const complex<double> f27ct_ref[45] = {-0.04505028290963531 - 4.123914609540503e-12 * myi, -0.03571562641145776 - 3.3283553457391752e-12 * myi, -0.026021471346933556 - 2.470963407894314e-12 * myi, -0.015936968033976706 - 1.543649908403359e-12 * myi, -0.005426952286864184 - 5.36786905764194e-13 * myi, 0.005548920776019206 + 5.611360414563721e-13 * myi, 0.017037276212515384 + 1.7643509111750194e-12 * myi, 0.029092432921328126 + 3.089723044977223e-12 * myi, 0.0417782475553613 + 4.558784583472264e-12 * myi, -0.04505028290963531 - 4.123914609540503e-12 * myi, -0.03571562641145776 - 3.3283553457391752e-12 * myi, -0.026021471346933556 - 2.470963407894314e-12 * myi, -0.015936968033976706 - 1.543649908403359e-12 * myi, -0.005426952286864184 - 5.36786905764194e-13 * myi, 0.005548920776019206 + 5.611360414563721e-13 * myi, 0.017037276212515384 + 1.7643509111750194e-12 * myi, 0.029092432921328126 + 3.089723044977223e-12 * myi, 0.0417782475553613 + 4.558784583472264e-12 * myi, -0.04505028290963531 - 4.123914609540503e-12 * myi, -0.03571562641145776 - 3.3283553457391752e-12 * myi, -0.026021471346933556 - 2.470963407894314e-12 * myi, -0.015936968033976706 - 1.543649908403359e-12 * myi, -0.005426952286864184 - 5.36786905764194e-13 * myi, 0.005548920776019206 + 5.611360414563721e-13 * myi, 0.017037276212515384 + 1.7643509111750194e-12 * myi, 0.029092432921328126 + 3.089723044977223e-12 * myi, 0.0417782475553613 + 4.558784583472264e-12 * myi, -0.04505028290963531 - 4.123914609540503e-12 * myi, -0.03571562641145776 - 3.3283553457391752e-12 * myi, -0.026021471346933556 - 2.470963407894314e-12 * myi, -0.015936968033976706 - 1.543649908403359e-12 * myi, -0.005426952286864184 - 5.36786905764194e-13 * myi, 0.005548920776019206 + 5.611360414563721e-13 * myi, 0.017037276212515384 + 1.7643509111750194e-12 * myi, 0.029092432921328126 + 3.089723044977223e-12 * myi, 0.0417782475553613 + 4.558784583472264e-12 * myi, -0.04505028290963531 - 4.123914609540503e-12 * myi, -0.03571562641145776 - 3.3283553457391752e-12 * myi, -0.026021471346933556 - 2.470963407894314e-12 * myi, -0.015936968033976706 - 1.543649908403359e-12 * myi, -0.005426952286864184 - 5.36786905764194e-13 * myi, 0.005548920776019206 + 5.611360414563721e-13 * myi, 0.017037276212515384 + 1.7643509111750194e-12 * myi, 0.029092432921328126 + 3.089723044977223e-12 * myi, 0.0417782475553613 + 4.558784583472264e-12 * myi};

                // The computation took 5.27316s AbsoluteTiming with the Mathematica-Ginac script from [AGV:2019A]
                const complex<double> f29ct_ref[45] = {-1.608986716471776+3.934295499979576e-9*myi,-2.3693283777971317+4.271854880838442e-9*myi,-3.7800190331181796+4.402372917703126e-9*myi,-6.599376801954662+3.5067631829492385e-9*myi,-13.404671606463694-3.753818639220557e-9*myi,-50.98081440086062+1.7772205299757942*myi,52.76153897156211-38.65385854966077*myi,34.66130927641784-12.829931777947536*myi,29.017679457734744-5.407202046720414*myi,-2.401870228870557+2.652835236941801e-9*myi,-3.1817692982717034+2.698718235901337e-9*myi,-4.538488326070166+2.4507032774885e-9*myi,-7.036633206233375+1.244260771205401e-9*myi,-12.213990799607984-3.984122385193444e-9*myi,-30.90700561930492+1.7772206377857764*myi,107.16140038893903-148.86783796939537*myi,46.114443570219464-23.70169235520142*myi,35.328110799930535-9.590736456099371*myi,-2.9414233745675844+1.8750311194276108e-9*myi,-3.6918220890152753+1.7933824848964267e-9*myi,-4.938908656081523+1.4262694196122121e-9*myi,-7.0986719328511185+2.821701102354999e-10*myi,-11.102215787231103-3.4649922257079255e-9*myi,-23.22044639006853+1.7772206593931228*myi,-89.78355190008688+1.0954637858202039*myi,62.98816795440386-46.82941116582578*myi,42.92255440219149-16.42890162479344*myi,-3.3211858277453743+1.3656343000405952e-9*myi,-4.021094256914381+1.2293665602458048e-9*myi,-5.1442919083031455+8.41362748745472e-10*myi,-6.997705859671058-1.5657051029408877e-10*myi,-10.142144919941671-2.905822344058433e-9*myi,-18.936989330517427+1.7772206675965885*myi,-45.21119817675006+1.0954640964488*myi,102.8561882200495-124.64515483844737*myi,52.751369875880215-27.83701399063691*myi,-3.5939711464536828+1.0157641805518302e-9*myi,-4.235378448263781+8.599867522896628e-10*myi,-5.23645786793729+4.89817231583082e-10*myi,-6.824324716574154-3.572393189764593e-10*myi,-9.323332766521304-2.4259036057229785e-9*myi,-16.137135778031848+1.777220671669935*myi,-31.4613064877505+1.0954641421398201*myi,-146.15081645857504+0.7784645027656028*myi,67.4668671122318-49.36283092562938*myi};

                for (unsigned int i = 0; i < 45; i++)
                {
                    const double z = z_s_list[i][0];
                    const complex<double> s = z_s_list[i][1];
                    agv_2019a::CharmLoopsParameters testclp = {/*muhat =*/ 1.0, /*s =*/ s, /*z =*/ z, /*feynepsilonhat*/ 1e-10};

                    const complex<double> f17ct = agv_2019a::f17ctQs(testclp) + agv_2019a::f17ctQc(testclp) + agv_2019a::f17ctQb(testclp);
                    const complex<double> f19ct = agv_2019a::f19ctQs(testclp) + agv_2019a::f19ctQc(testclp) + agv_2019a::f19ctQb(testclp);
                    const complex<double> f27ct = agv_2019a::f27ctQs(testclp) + agv_2019a::f27ctQc(testclp) + agv_2019a::f27ctQb(testclp);
                    const complex<double> f29ct = agv_2019a::f29ctQs(testclp) + agv_2019a::f29ctQc(testclp) + agv_2019a::f29ctQb(testclp);

                    TEST_CHECK_NEARLY_EQUAL(f17ct_ref[i].real(), f17ct.real(), eps);
                    TEST_CHECK_NEARLY_EQUAL(f17ct_ref[i].imag(), f17ct.imag(), eps);

                    TEST_CHECK_NEARLY_EQUAL(f19ct_ref[i].real(), f19ct.real(), eps);
                    TEST_CHECK_NEARLY_EQUAL(f19ct_ref[i].imag(), f19ct.imag(), eps);

                    TEST_CHECK_NEARLY_EQUAL(f27ct_ref[i].real(), f27ct.real(), eps);
                    TEST_CHECK_NEARLY_EQUAL(f27ct_ref[i].imag(), f27ct.imag(), eps);

                    TEST_CHECK_NEARLY_EQUAL(f29ct_ref[i].real(), f29ct.real(), eps);
                    TEST_CHECK_NEARLY_EQUAL(f29ct_ref[i].imag(), f29ct.imag(), eps);
                }
            }

            // Two loop functions

            {
                static double eps = 1e-12;

                // The computation took 19.5591s AbsoluteTiming with the Methematica-Ginac script from [AGV:2019A]
                const complex<double> f27a_ref[45] = {0.22820842548329867+0.03284371205569114*myi,0.24322769157762436+0.038807446284946145*myi,0.26125394694869497+0.047508301945062836*myi,0.28369187897119896+0.061560652401266236*myi,0.31282262823987966+0.08948335331359147*myi,0.30793554542001145+0.15190390991685027*myi,0.2835394815474132+0.17453482839483492*myi,0.2659117064548151+0.18807482777462914*myi,0.25167739857336713+0.19779897979563899*myi,0.1942262099395171+0.015747105165950348*myi,0.20751249514080594+0.01884930884765368*myi,0.22372458623749508+0.02351831767405843*myi,0.24463371479392249+0.03143542261205623*myi,0.274534554628007+0.0487104444737394*myi,0.28542163932296316+0.10497461448205425*myi,0.2675801944480435+0.13175126609782584*myi,0.2534960136717421+0.1482279346961768*myi,0.241627863938783+0.16025051932819934*myi,0.16645325509067144+0.0070655760260136535*myi,0.17797119045536447+0.008554220180702288*myi,0.19206401194042821+0.01085624811041852*myi,0.21046491233817016+0.014932462684399517*myi,0.23802694089995924+0.024626783050882728*myi,0.25871995614499+0.07169968659932635*myi,0.24716924227864856+0.0998914003429483*myi,0.23666032853125607+0.11777793089896793*myi,0.22725464768356218+0.13105242565722863*myi,0.14385120056625744+0.0028418587109217963*myi,0.15383165223752537+0.0034769130379967983*myi,0.16597783790901066+0.004483920247051687*myi,0.18180478887241847+0.006341870696572438*myi,0.205882958222052+0.011154491652198506*myi,0.23162741198184045+0.04861818766051762*myi,0.22551840625100988+0.07638961331501815*myi,0.21826240395351126+0.09461115090738242*myi,0.21116191302573561+0.10838289879031443*myi,0.1253602314267599+0.0009632892835105267*myi,0.13409970793541337+0.0011904116273360188*myi,0.14463317059892322+0.0015593946514974588*myi,0.1582094609654583+0.002268564706348397*myi,0.17872815784755386+0.004277619489111539*myi,0.20604953478302296+0.033090915231659634*myi,0.20431183133982378+0.05927954183803186*myi,0.19983162152652945+0.07710369130760691*myi,0.1947612479177847+0.09084011783500079*myi};

                // The computation took 22.2867s AbsoluteTiming with the Methematica-Ginac script from [AGV:2019A]
                const complex<double> f29a_ref[45] = {-1.327593865389298-0.26354311133041985*myi,-1.4752272048905066-0.31892150923336793*myi,-1.701417762302468-0.4053802100753181*myi,-2.1007213493562373-0.5630064622825302*myi,-3.150248273544651-0.9902966237413686*myi,-0.7597102025321296-4.134375257724479*myi,0.16753628934200737-2.9100769956755577*myi,0.4974848467549766-2.3381370294447197*myi,0.6773412441390434-1.9597798499797952*myi,-1.174311190527999-0.15514452828030834*myi,-1.3103448154388344-0.1897059207632319*myi,-1.5228195635238784-0.24487728930679786*myi,-1.9067438800032237-0.34893822649070927*myi,-2.9484978085140274-0.6491865159295083*myi,-0.8585268855028432-3.8355451575958712*myi,0.09347127701492153-2.6969010669564253*myi,0.4332264060021709-2.1601946401686285*myi,0.6189732755843638-1.8032387227327886*myi,-1.031851997909416-0.08601215472262158*myi,-1.1541823598664762-0.10610702883207601*myi,-1.3485806069093482-0.13881082239841191*myi,-1.707045931604111-0.20240218784562547*myi,-2.708647789225609-0.39708733657481154*myi,-0.8966424700433189-3.5458869195213674*myi,0.05895489858151093-2.4918355485129613*myi,0.4005894972674273-1.9895284697137834*myi,0.5876647077034924-1.6533316758674381*myi,-0.9033591077645449-0.04355378332207671*myi,-1.0118657632051313-0.05415494340115856*myi,-1.1870941854763062-0.07171553361522243*myi,-1.5160352669914974-0.1068565395336103*myi,-2.459127048591247-0.22100616808667084*myi,-0.8860758954385597-3.274680785067058*myi,0.055600033360480694-2.2993133350758126*myi,0.392636146665593-1.8290654279801188*myi,0.5773484745524833-1.5122277422367745*myi,-0.7895963007241877-0.019228145658293005*myi,-0.8852409765960578-0.02408278061223923*myi,-1.042123061348065-0.032260072893188774*myi,-1.3413611068846678-0.04909068922306581*myi,-2.2182923911288244-0.10724895973649762*myi,-0.8371655238898433-3.0282708948147423*myi,0.07680072001682103-2.122363664368087*myi,0.40411706671191006-1.6807994286205883*myi,0.5835471540035471-1.3813992013466887*myi};

                // The computation took 83.3218s AbsoluteTiming with the Mathematica-Ginac script from [AGV:2019A]
                const complex<double> f27b_ref[45] = {0.22116104744579745-5.5334126169981346e-11*myi,0.20735428622243157-5.7376103868023165e-11*myi,0.19305033438721408-5.954226001136931e-11*myi,0.1782084657024352-6.184797118891083e-11*myi,0.16278245487666587-6.430883603414372e-11*myi,0.1467195039633833-6.694622634029201e-11*myi,0.1299588861684262-6.978229105669698e-11*myi,0.11243021094760941-7.285905212484067e-11*myi,0.09405117317643885-7.645439836778678e-11*myi,0.23600156921419213-4.4674319799042905e-11*myi,0.22239592222915672-4.651884433215514e-11*myi,0.20830218848609006-4.847799939255992e-11*myi,0.19368042539307972-5.056499663425029e-11*myi,0.17848529636420096-5.2794324467697606e-11*myi,0.16266501708188308-5.518474566201803e-11*myi,0.14616002416645912-5.775502298632773e-11*myi,0.12890127174735078-6.055067558463634e-11*myi,0.11080802098258857-6.400568963726982e-11*myi,0.24882632335598132-3.7410519126979125e-11*myi,0.23538728178064572-3.912170587483388e-11*myi,0.22146752951941262-4.0941139367589585e-11*myi,0.20702774985262873-4.2879033657072796e-11*myi,0.19202331511608017-4.495293026707259e-11*myi,0.17640324854303957-4.717759516381648e-11*myi,0.1601089124094912-4.9573900540167415e-11*myi,0.14307232922789126-5.2166271302667155e-11*myi,0.12521400279035788-5.5422333389287814e-11*myi,0.2602318289764167-3.200084641719059e-11*myi,0.24693559950846455-3.3614222516575865e-11*myi,0.23316485807265486-3.533040526804143e-11*myi,0.21888080713768954-3.7159830768018765e-11*myi,0.20403940647623764-3.9118042138852616e-11*myi,0.18859034771783278-4.122013841367789e-11*myi,0.17247575836516482-4.348699178535753e-11*myi,0.1556285430290103-4.5986325858393684e-11*myi,0.13797023009533405-4.843059286940843e-11*myi,0.2705632944288101-2.7750690634320563e-11*myi,0.2573922497380883-2.928768338961163e-11*myi,0.24375203037357562-3.092315292718695e-11*myi,0.22960428059676508-3.266831249959523e-11*myi,0.2149054595512967-3.4537039894644295e-11*myi,0.19960582646857494-3.65427688109321e-11*myi,0.18364815797124834-3.871214460104966e-11*myi,0.1669661060679175-4.1026737562788185e-11*myi,0.14948206622557336-4.359890226623975e-11*myi};

                // The computation took 108.757s AbsoluteTiming with the Mathematica-Ginac script from [AGV:2019A]
                const complex<double> f29b_ref[45] = {-0.5199119415599585-1.4654322200158276e-10*myi,-0.5079622656422487-1.4769074851983532e-10*myi,-0.49599108866826214-1.489528500542292e-10*myi,-0.4840162125816292-1.503384083889614e-10*myi,-0.4720598373043323-1.5189627333711542e-10*myi,-0.460149740874094-1.5361578675765486e-10*myi,-0.44832084337332745-1.5553514032262683e-10*myi,-0.4366173073315984-1.5758061522319622e-10*myi,-0.4250954011656063-1.5927525964798406e-10*myi,-0.48529093847569627-1.256079684708311e-10*myi,-0.472775719200496-1.263318338828867e-10*myi,-0.46020878323730496-1.2712941810377743e-10*myi,-0.4476049181150774-1.2803980098397005e-10*myi,-0.43498284742866034-1.290487716687494e-10*myi,-0.4223663122083252-1.3022827261011116e-10*myi,-0.40978550820379667-1.3154366484968705e-10*myi,-0.39727902173666507-1.3297096757014515e-10*myi,-0.3848964761693878-1.3426415534922853e-10*myi,-0.45456645876278046-1.1091660923057134e-10*myi,-0.4415583724370755-1.113260594820531e-10*myi,-0.42847239058854125-1.1179590586607446e-10*myi,-0.4153206959735485-1.1234924102154764e-10*myi,-0.40211900886071206-1.1298340041321353e-10*myi,-0.388887583260777-1.1377032649306784e-10*myi,-0.37565253505635354-1.1464074134437396e-10*myi,-0.3624476360516695-1.155981976808107e-10*myi,-0.34931677349220536-1.1789325071731582e-10*myi,-0.4266432358479504-9.969003400556176e-11*myi,-0.4131944254001585-9.985168247794718e-11*myi,-0.3996444444458893-1.0007283890445251e-10*myi,-0.3860031666055681-1.0035439146349745e-10*myi,-0.3722836503243183-1.00714103723476e-10*myi,-0.35850305985416675-1.0116885107436246e-10*myi,-0.3446838969318833-1.0172129805141594e-10*myi,-0.3308556695551772-1.0232525937681203e-10*myi,-0.3170571863802252-1.0311396181350574e-10*myi,-0.40087824318121124-9.065548312037208e-11*myi,-0.3870286799616509-9.062439687568258e-11*myi,-0.37305689677621334-9.063505501671898e-11*myi,-0.35897068488351636-9.069545114925859e-11*myi,-0.3447807028992944-9.0812690700659e-11*myi,-0.33050133013493443-9.102318898612793e-11*myi,-0.3161518115891475-9.131895239988808e-11*myi,-0.30175781416141945-9.164580205833772e-11*myi,-0.2873535727203489-9.276845958083868e-11*myi};

                // The computation took 38.0936s AbsoluteTiming with the Mathematica-Ginac script from [AGV:2019A]
                const complex<double> f27c_ref[45] = {1.6791188931480354+0.176035647094692*myi,1.8445207172828009+0.22491670644554373*myi,2.039637263807971+0.29730968194630775*myi,2.272896086709195+0.41084782274089404*myi,2.549536785805979+0.601808734589645*myi,2.827806363319306+0.9245760968901244*myi,3.0754663141059595+1.7691695215566483*myi,2.6058034231749705+2.181421117441232*myi,2.279797531379785+2.350344220275119*myi,1.484743676467711+0.11361500496449817*myi,1.6269481151672336+0.14452145433548835*myi,1.793156719131109+0.18988086952137584*myi,1.9904759809253152+0.2601102467789501*myi,2.2257045229267924+0.37613871047342284*myi,2.4857658838282046+0.5765911372455763*myi,3.1416997323708813+0.7601944755598984*myi,2.8440086840698187+1.725913168485203*myi,2.4961456676789524+2.046984350070474*myi,1.3168845149308028+0.07081490948937363*myi,1.4401326832344288+0.08983704116886254*myi,1.582817619753906+0.11762279270003301*myi,1.7508368251793547+0.16039324744905237*myi,1.9511183497668894+0.23067496202722326*myi,2.1833585326977936+0.35426411305347916*myi,2.3452983398140606+0.5171740670821414*myi,2.977072733932623+1.1206774043534402*myi,2.6724361288312366+1.6750448942107994*myi,1.16957799802036+0.04166580412826543*myi,1.2770492135049047+0.052777116063518335*myi,1.4002120709097787+0.06897286248920559*myi,1.5438511429916377+0.09385314550921109*myi,1.714290631468566+0.13474026970042674*myi,1.9165961456360656+0.20774456244040174*myi,2.120944344168538+0.34227779599615715*myi,2.8233710535070475+0.26928476879405494*myi,2.7856818014716183+1.2184027574251957*myi,1.0390818597513611+0.02237301526240776*myi,1.1333078877013394+0.028317910732284512*myi,1.2401166856635362+0.036977789310918*myi,1.3632657540420463+0.05028109592823782*myi,1.5080618886040846+0.07219171884337117*myi,1.6810035995398285+0.11178669807703567*myi,1.8794068499956147+0.19171297494068718*myi,1.8932930155997258+0.26923528871960656*myi,2.7836870826023272+0.6523003925748014*myi};

                // The computation took 42.7845s AbsoluteTiming with the Mathematica-Ginac script from [AGV:2019A]
                const complex<double> f29c_ref[45] = {4.513856529852124+0.0207355852668627*myi,5.361223602411098+0.046867419372780716*myi,6.624108607271655+0.10225601541733553*myi,8.65620349138604+0.23447062307073452*myi,12.433907173691708+0.6243478653382832*myi,22.821909202485084+2.567179581454365*myi,10.692084535966496+33.60298442326314*myi,-2.8798399539731907+26.463237013362225*myi,-7.824065464593247+21.343149376344343*myi,4.0358639153977585-0.01672342427738016*myi,4.704428485527288-0.011223111902779692*myi,5.677680935841327+0.0045368523830759955*myi,7.181239815332177+0.048603859585540476*myi,9.762725143675464+0.18599482897810304*myi,15.33406642968113+0.7673801354773317*myi,29.98647118915443+28.318563553995926*myi,3.1848420350278523+28.184157826656254*myi,-4.593443179030643+23.166621144288627*myi,3.6495067319840047-0.029840490762190086*myi,4.181776694049864-0.03333773896234149*myi,4.942720134717311-0.0352004613257364*myi,6.081961266976778-0.03016274884331871*myi,7.929399611129133+0.0019154474534452959*myi,11.429867994081569+0.16184551665261893*myi,21.880073581287125+1.51626737880229*myi,11.389018404101098+28.215748987292642*myi,-0.5552453106487576+24.507107317068886*myi,3.337499192173418-0.02912944629051495*myi,3.7645367447525793-0.03510936110315299*myi,4.366798023150222-0.04261492246199339*myi,5.2465829209420045-0.05131691634560376*myi,6.612458463566568-0.057668184411678425*myi,8.985004117418619-0.03886656472050731*myi,14.315559518816258+0.2047904690843776*myi,23.63360332122115+24.05165030208523*myi,4.454180994470647+25.124699774631836*myi,3.0857372777635668-0.021835153585378464*myi,3.430723648432444-0.02704941225633206*myi,3.9127406310524773-0.0342688089151153*myi,4.603748413145579-0.0445117754490898*myi,5.640933373917424-0.059131123402437424*myi,7.331718576160419-0.07784223163139359*myi,10.596647403375428-0.0739379390605599*myi,21.682218300103465+0.7364793070766922*myi,10.808478393410638+24.52304908051292*myi};

                //const complex<double> f27d_ref[45] = {4.462519805933196+0.28659888959268875*myi,3.6579187343594284+0.3129262921056326*myi,2.6059311195104105+0.42206006619077774*myi,1.3911743279211244+0.7403937453213882*myi,0.4947208218166242+1.6026287429417103*myi,1.319843818238475+3.884777877878817*myi,13.982066502413579-9.859272187092685*myi,201.46690655810727-92.37577832836641*myi,3371.3792934839003-1132.636471274779*myi,5.23263753909333+0.21250954666503974*myi,4.30508848529041+0.2687178808983648*myi,3.1102955369345664+0.435479627928387*myi,1.7694706656664323+0.8670762949587849*myi,0.9045309088819339+1.9663554052403907*myi,2.6344436776873756+4.859773012493862*myi,1.3270289083134925-4.287137972038057*myi,194.69124870203612-142.20428232671028*myi,3704.6667589205354-1878.688464934644*myi,5.7193726960003906+0.15735261965890102*myi,4.721735570628093+0.2349471962362082*myi,3.4542595011221344+0.4394498696133986*myi,2.072615850030517+0.9398342511245245*myi,1.3224398784526932+2.174981501422588*myi,3.9169173464904112+5.407819441552095*myi,14.252446094584029+14.19323186306649*myi,142.7935407827747-172.35837594470638*myi,3587.867618558565-2562.3332817379082*myi,6.068368154183037+0.11634873612172107*myi,5.026869314311775+0.207346559014849*myi,3.7199565771396386+0.4322608286682557*myi,2.335531558496587+0.9641793626936076*myi,1.7326087513936934+2.251534863450931*myi,5.1482960754038904+5.604825290495338*myi,22.94488308610916+15.387940118362899*myi,36.38404407341403-149.68202024794618*myi,3087.373820509828-3112.6431844325293*myi,6.338703811303942+0.08549507980296811*myi,5.267958577566312+0.1823187606882688*myi,3.939072402392328+0.4118667186014142*myi,2.569802608373635+0.9421276904785195*myi,2.123746820831667+2.2076399252125345*myi,6.308136875984852+5.489895112679932*myi,29.293981204474047+15.306398338238203*myi,76.30397598287546+48.54385782785695*myi,2182.5043535983878-3417.507478535873*myi};

                //const complex<double> f29d_ref[45] = {7.367673368083917+5.56270158314312*myi,7.119750716765626+5.424439454024437*myi,6.851637268164385+5.228076626438579*myi,6.876506954716152+5.106302321131862*myi,8.508392270067716+5.6520484481595155*myi,19.16937581587287+9.435383555448366*myi,28.95620071124323+61.04628062262866*myi,129.52185932182078+183.87557624795232*myi,2023.3096105404484+1608.155796577263*myi,9.802977830925064+4.622416180696061*myi,9.542053649601181+4.6868604332132335*myi,9.293401981946364+4.791767277520011*myi,9.481567053194565+5.0993161986788635*myi,11.740575217820297+6.186407280421212*myi,23.31770937565402+10.298781404571105*myi,73.18118486244185+87.82813130352159*myi,191.0005530451417+191.2183166907857*myi,2694.4820338970585+1082.928865521399*myi,11.524625596292292+3.92174444791286*myi,11.311757721969677+4.099564842440808*myi,11.163145950835766+4.37272262617816*myi,11.593970617670603+4.914591143113422*myi,14.470804846374463+6.272805422370732*myi,27.311570808888938+10.429544275146467*myi,95.01281534747079+26.360079866760103*myi,250.08473424999465+223.8545782347874*myi,3061.0658367271135+791.1990925355476*myi,12.854592075602463+3.329726980138516*myi,12.710457859603624+3.567159216529783*myi,12.685732648556742+3.9284247758121826*myi,13.37091506868204+4.585942158691796*myi,16.816876600592572+6.045815547569456*myi,30.882627725661877+10.045937652232372*myi,94.01261616751889+24.155655767169108*myi,356.9284317082207+295.9987142046686*myi,3276.4244640742227+686.0423891838689*myi,13.93113412870685+2.7911483356202655*myi,13.860824877003001+3.0511727678661895*myi,13.96270634789319+3.445303506492368*myi,14.890792198031296+4.13594015481488*myi,18.848522671865727+5.576578954753695*myi,34.03497171958718+9.263546727342254*myi,98.13467901057444+21.509145827877912*myi,502.2062717138326+82.58902672569181*myi,3439.1238207203182+789.8574446315467*myi};

                // The computation took 5.55759s AbsoluteTiming with the Mathematica-Ginac script from [AGV:2019A]
                // feynepsilonhat = 1e-10
                const complex<double> f29e_ref[45] = {2.3021828027409255 - 6.463426460712185e-10 * myi, 2.385948579526878 - 1.044983460873894e-9 * myi, 2.700100154127618 - 1.5445331680297159e-9 * myi, 3.6163362509571346 - 1.932085602618372e-9 * myi, 6.666877489981057 + 2.8917135352912737e-10 * myi, 28.623209566833367 + 9.837709313842424e-8 * myi, -48.40967194198186 - 5.577487933474039 * myi, -16.874156506724486 - 14.088669006050232 * myi, -8.120489514625849 - 13.065461479444517 * myi, 2.3891251350058544 - 1.0545575523934758e-10 * myi, 2.53201813513229 - 2.763216322421158e-10 * myi, 2.905754685469725 - 4.0957903735261425e-10 * myi, 3.8132032921355905 - 2.3579538321882865e-10 * myi, 6.262937168090792 + 1.854425946135052e-9 * myi, 16.09708865543818 + 2.5199682340826257e-8 * myi, -139.6018251283025 + 89.57165539021763 * myi, -34.10106085600972 - 12.77883576501469 * myi, -16.18476485749127 - 15.329293002930044 * myi, 2.360596786243271 + 2.0758150753863447e-10 * myi, 2.5208807225145855 + 1.4876189169399368e-10 * myi, 2.8920338899305498 + 1.6927081958328927e-10 * myi, 3.710589948855498 + 4.959286314942801e-10 * myi, 5.655080738092669 + 2.130152054746759e-9 * myi, 11.553725232419755 + 1.2162026052919828e-8 * myi, 58.30623682360957 + 3.0637617953743757e-7 * myi,-62.76950940050142 + 0.031852335768391526 * myi, -27.510523556251457 - 15.546163093825761 * myi, 2.2611611038878188 + 3.9498049275721314e-10 * myi, 2.417885207731062 + 3.929780945099992e-10 * myi, 2.7603235654499256 + 4.773212936015625e-10 * myi, 3.4718374685672275 + 8.230784942497849e-10 * myi, 5.022765191422876 + 2.0671784284331807e-9 * myi, 8.99999956749037 + 7.480778663193632e-9 * myi, 25.235965138100266 + 5.594193908109446e-8 * myi, -129.21960318321723 + 67.6483365255224 * myi, -43.80351847021929 - 11.716589533222155 * myi, 2.1167522450187013 + 5.073221842621933e-10 * myi, 2.2593251623889987 + 5.336877606509915e-10 * myi, 2.5628117869741036 + 6.408615860209466e-10 * myi, 3.1698959791101298 + 9.60874046995741e-10 * myi, 4.4158702116722175 + 1.9111201510213505e-9 * myi, 7.274234695054613 + 5.2121578164587845e-9 * myi, 15.966659039855655 + 2.29688197350697e-8 * myi, 104.86751778726 + 8.100933825971879e-7 * myi, -69.40585654227208 + 1.840951225135683 * myi};

                // feynepsilonhat = 1e-14
                //const complex<double> f29ev2_ref[45] = {2.302182802740934 - 6.583622536027178e-14*myi,2.3859485795268744 - 1.0219602941674566e-13*myi, 2.700100154127613 - 1.5587531265737198e-13*myi,3.6163362509571346 - 1.8740564655672642e-13*myi, 6.66687748998105 + 3.019806626980426e-14*myi,28.623209566833353 + 9.833911462919787e-12*myi, -48.40967203064752 - 5.577488119383567*myi,-16.87415650098007 - 14.088669061363333*myi, -8.120489503002077 - 13.065461506979855*myi,2.38912513500586 - 1.2323475573339238e-14*myi, 2.532018135132292 - 2.7533531010703882e-14*myi,2.90575468546973 - 4.796163466380676e-14*myi, 3.8132032921355923 - 2.7533531010703882e-14*myi,6.2629371680907635 + 1.3855583347321954e-13*myi, 16.09708865543817 + 2.5579538487363607e-12*myi,-139.6018264704346 + 89.57165452714135*myi, -34.10106087706429 - 12.778835852309772*myi,-16.18476485202037 - 15.329293041771372*myi, 2.360596786243269 + 2.7977620220553945e-14*myi,2.5208807225145855 + 1.509903313490213e-14*myi, 2.892033889930551 + 1.0658141036401503e-14*myi,3.7105899488554925 + 5.1514348342607263e-14*myi, 5.65508073809269 + 1.5987211554602254e-13*myi,11.55372523241972 + 1.2647660696529783e-12*myi, 58.30623682360959 + 3.065281362069072e-11*myi,-62.76950950082173 + 0.031852180036352706*myi, -27.510523562152954 - 15.546163148512225*myi,2.2611611038878183 + 4.75175454539567e-14*myi, 2.417885207731071 + 4.3520742565306136e-14*myi,2.760323565449924 + 3.730349362740526e-14*myi, 3.4718374685672426 + 6.572520305780927e-14*myi,5.022765191422869 + 2.5934809855243657e-13*myi, 8.999999567490438 + 7.744915819785092e-13*myi,25.235965138100273 + 5.5990767577895895e-12*myi, -129.21960387622306 + 67.64833601689656*myi,-43.80351849993297 - 11.716589613824716*myi, 2.1167522450187004 + 5.773159728050814e-14*myi,2.2593251623889863 + 6.128431095930864e-14*myi, 2.5628117869741107 + 7.016609515630989e-14*myi,3.169895979110128 + 1.2079226507921703e-13*myi, 4.415870211672161 + 2.327027459614328e-13*myi,7.274234695054517 + 4.831690603168681e-13*myi, 15.966659039855637 + 2.3092638912203256e-12*myi,104.86751778725996 + 8.100187187665142e-11*myi, -69.40585663652078 + 1.840951089440921*myi};

                // The computation took 529.971s Absolute Timing  with the Mathematica-Ginac script from [AGV:2019A]
                const complex<double> weight4_ref[45] = {-19.943420811418328+69.12220075921215*myi,-19.416443825764926+61.44724076199987*myi,-17.984247025545407+51.31949556440109*myi,-13.777863810921685+2.733071662104102*myi,8.674632363281113+19.542554412182277*myi,30.07316975834337+19.542554456149478*myi,63.6707962441056+38.33290778438321*myi,55.85473719298716+58.28664153474111*myi,50.59673164867681+64.65080087804398*myi,-14.111520882997851+52.742811453410425*myi,-13.64355405351835+46.19062797386781*myi,-12.313747867972491-8.363570364325646*myi,-8.231462396319344+4.263599579897788*myi,10.045531919479885+14.61047900343665*myi,24.199606613103537+14.61047902261622*myi,43.32220638388199+10.053515836533045*myi,52.112918509506244+38.11746664591408*myi,47.63463065732847+46.04664983323184*myi,-10.949530350509928+42.892826885112825*myi,-10.506343564100487+37.07697858601813*myi,-9.225342467632995-6.374641319575888*myi,-5.171235437378367+4.73670584517861*myi,10.220766158584777+11.54533957725176*myi,20.808273263431772+11.545339587931041*myi,31.358041265731465+11.545339600173271*myi,48.49447980896905+24.05487143714152*myi,44.93020246591302+34.23123868770222*myi,-8.978763604506938+36.19307599339755*myi,-8.547588424121663-12.080904732324846*myi,-7.294800435494734-5.189794855432012*myi,-3.224482270673864+4.83276111583443*myi,10.022034006640979+9.416050201902173*myi,18.487991466320267+9.416050208698277*myi,26.557089960840663+9.416050216357085*myi,43.73252756441579+9.964783641489575*myi,42.51684699294689+25.570152629372146*myi,-7.646273276764368-15.619145116421054*myi,-7.221608252046043-10.753312955346782*myi,-5.987487396834586-4.416920363980466*myi,-1.8712748698202644+4.773981287308398*myi,9.68865087707498+7.837272221559653*myi,16.747772443711817+7.837272226263501*myi,23.25903826271488+7.837272231208386*myi,30.89186482276262+7.837272238464681*myi,40.29674647809264+18.441714179671777*myi};

                /*
                    The tests checks, whether the two-loop functions equals the reference values up to an absolute error epsilon. For s -> -1 this
                    is not the best way to go since the functions become large and a check for relative error would be better suited. The method
                    might need to be adapted in the future to the specific value of s.
                */
                for (unsigned int i = 0; i < 45; i++)
                {
                    std::cout << i+1 << std::endl;

                    const double z = z_s_list[i][0];
                    const complex<double> s = z_s_list[i][1];
                    agv_2019a::CharmLoopsParameters testclp = {/*muhat =*/ 1.0, /*s =*/ s, /*z =*/ z, /*feynepsilonhat*/ 1e-10};

                    const complex<double> f27a_res = agv_2019a::f27a(testclp);
                    const complex<double> f29a_res = agv_2019a::f29a(testclp);

                    const complex<double> f27b_res = agv_2019a::f27b(testclp);
                    const complex<double> f29b_res = agv_2019a::f29b(testclp);

                    const complex<double> f27c_res = agv_2019a::f27c(testclp);
                    const complex<double> f29c_res = agv_2019a::f29c(testclp);

                    //const complex<double> f27d_res = agv_2019a::f27d(testclp);
                    //const complex<double> f29d_res = agv_2019a::f29d(testclp);

                    //const complex<double> weight4_res = agv_2019a::GPLweight4Parts(testclp);

                    const complex<double> f29e_res = agv_2019a::f29e(testclp);

                    TEST_CHECK_NEARLY_EQUAL(f27a_ref[i].real(), f27a_res.real(), eps);
                    TEST_CHECK_NEARLY_EQUAL(f27a_ref[i].imag(), f27a_res.imag(), eps);

                    TEST_CHECK_NEARLY_EQUAL(f29a_ref[i].real(), f29a_res.real(), eps);
                    TEST_CHECK_NEARLY_EQUAL(f29a_ref[i].imag(), f29a_res.imag(), eps);

                    TEST_CHECK_NEARLY_EQUAL(f27b_ref[i].real(), f27b_res.real(), 12*eps);
                    TEST_CHECK_NEARLY_EQUAL(f27b_ref[i].imag(), f27b_res.imag(), 12*eps);

                    TEST_CHECK_NEARLY_EQUAL(f29b_ref[i].real(), f29b_res.real(), 30*eps);
                    TEST_CHECK_NEARLY_EQUAL(f29b_ref[i].imag(), f29b_res.imag(), 30*eps);

                    TEST_CHECK_NEARLY_EQUAL(f27c_ref[i].real(), f27c_res.real(), 5*eps);
                    TEST_CHECK_NEARLY_EQUAL(f27c_ref[i].imag(), f27c_res.imag(), 5*eps);

                    TEST_CHECK_NEARLY_EQUAL(f29c_ref[i].real(), f29c_res.real(), 150*eps);
                    TEST_CHECK_NEARLY_EQUAL(f29c_ref[i].imag(), f29c_res.imag(), 150*eps);

                    // TEST_CHECK_NEARLY_EQUAL(f27d_ref[i].real(), f27d_res.real(), 50*eps);
                    // TEST_CHECK_NEARLY_EQUAL(f27d_ref[i].imag(), f27d_res.imag(), 50*eps);

                    //TEST_CHECK_NEARLY_EQUAL(f29d_ref[i].real(), f29d_res.real(), 50*eps);
                    //TEST_CHECK_NEARLY_EQUAL(f29d_ref[i].imag(), f29d_res.imag(), 50*eps);

                    //TEST_CHECK_NEARLY_EQUAL(weight4_ref[i].real(), weight4_res.real(), 5.1*eps);
                    //TEST_CHECK_NEARLY_EQUAL(weight4_ref[i].imag(), weight4_res.imag(), 5.1*eps);

                    TEST_CHECK_NEARLY_EQUAL(f29e_ref[i].real(), f29e_res.real(), eps);
                    TEST_CHECK_NEARLY_EQUAL(f29e_ref[i].imag(), f29e_res.imag(), eps);
                }
            }
        }
} two_loop_test ;
